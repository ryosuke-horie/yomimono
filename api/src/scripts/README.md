# シードデータ生成スクリプト

効果的読書物プロジェクトの開発環境用のシードデータを生成するスクリプトです。

## 概要

このスクリプトは、開発・テスト環境でリアルな技術記事のブックマークデータを生成します。以下のデータが作成されます：

- **ブックマーク**: 現実的な技術記事URL（React, Node.js, TypeScript等）
- **ラベル**: 技術分野別のカテゴリラベル
- **記事-ラベル関連付け**: 各記事に1-3個のラベルを自動割り当て
- **お気に入り**: 一部の記事をお気に入りに設定

## 使用方法

### 基本的な実行

```bash
# デフォルト設定で実行（25記事、6ラベル、30%お気に入り率）
npm run seed
```

### スクリプトの直接実行

```bash
# Node.jsで直接実行
NODE_ENV=development npx tsx src/scripts/seed.ts

# または単純にファイルを実行
cd src/scripts && node seed.ts
```

## セーフティ機能

### 環境チェック
- **本番環境での実行を防止**: `NODE_ENV=production`の場合は自動的にエラーで停止
- **強制実行オプション**: `forceRun=true`で本番環境でも実行可能（注意して使用）

### データの重複防止
- 既存データとの重複は考慮されていないため、実行前にデータベースをクリアすることを推奨

## 生成されるデータ

### サンプル技術記事（30件）
- React 19の新機能
- Node.js パフォーマンスチューニング
- TypeScript 5.0の新機能
- マイクロサービスアーキテクチャ
- Kubernetesの監視とObservability
- その他モダンな技術記事

### ラベルカテゴリ（8種類）
- React
- Node.js  
- TypeScript
- データベース
- インフラ・DevOps
- セキュリティ
- アーキテクチャ
- パフォーマンス

## カスタマイズ

スクリプト内の設定を変更することで、生成データをカスタマイズできます：

```typescript
// デフォルト設定
const options = {
  bookmarkCount: 25,     // 生成するブックマーク数
  labelCount: 6,         // 生成するラベル数
  favoriteRatio: 0.3,    // お気に入り率（0-1）
  forceRun: false        // 本番環境での強制実行
};
```

## テスト

包括的なユニットテストが含まれています：

```bash
# シードスクリプトのテストを実行
NODE_ENV=test npx vitest run src/scripts/seed.ts

# すべてのテストを実行
npm test
```

### テストカバレッジ
- 環境チェック機能
- ランダムデータ生成機能
- 各データ生成関数の動作
- サンプルデータの妥当性検証

## トラブルシューティング

### よくある問題

1. **データベース接続エラー**
   ```
   Error: 本番環境でのシードデータ実行はサポートされていません
   ```
   → `NODE_ENV=development`が設定されているか確認

2. **SQLiteファイルが見つからない**
   ```
   Error: SQLITE_CANTOPEN: unable to open database file
   ```
   → データベースマイグレーションを先に実行: `npm run migrate:development`

3. **テストが失敗する**
   ```
   Error: 本番環境でのシードデータ実行は禁止されています
   ```
   → `NODE_ENV=test`でテストを実行: `NODE_ENV=test npm test`

## 実装詳細

### アーキテクチャ
- **レイヤード設計**: プロジェクトの既存パターンに従った設計
- **依存性注入**: リポジトリパターンを活用
- **エラーハンドリング**: 適切な例外処理とログ出力
- **型安全性**: TypeScriptの厳格な型チェック

### TDD実装
- **テスト駆動開発**: 実装と同時にテストを作成
- **インラインテスト**: vitestの`import.meta.vitest`パターンを採用
- **モックフリー**: 実際の関数動作をテスト

## セキュリティ考慮事項

- 本番環境での誤実行防止
- サンプルデータに機密情報は含まれていない
- 開発環境専用のSQLiteデータベースを使用