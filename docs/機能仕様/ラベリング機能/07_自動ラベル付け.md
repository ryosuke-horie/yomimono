# 自動ラベル付け機能

## 概要
Claude Code Actionを使用して、未ラベルのブックマークに対して自動的にラベルを付与する機能です。MCPツールを介してAPIと連携し、ブックマークのタイトルから適切なラベルを判定して割り当てます。

## 実行方法

### 1. 定期実行（日次バッチ）
- 毎日午前9時（JST）に自動実行
- `.github/workflows/auto-labeling.yml`で定義

### 2. 手動実行（GitHub Actions）
- GitHub ActionsのUIから`Auto Labeling with Claude`ワークフローを手動実行

### 3. Issueコメントからの実行
- Issue #770にコメントすることで実行可能
- `.github/workflows/manual-labeling.yml`で定義

#### コマンド一覧
- `/label all` - すべての未ラベルブックマークを自動ラベル付け
- `/label check` - 未ラベルブックマークの確認（ラベル付けは行わない）
- `/label specific [article_id] [label_name]` - 特定ブックマークへのラベル付け（API互換のためパラメータ名は`article_id`のまま）

## 処理フロー

1. **MCPサーバーのビルド**
   - `mcp`ディレクトリで `pnpm install` と `pnpm run build` を実行
   - TypeScriptをJavaScriptにコンパイル

2. **ラベル情報の取得**
   - `getLabels`ツールで既存ラベル一覧を取得

3. **未ラベルブックマークの取得**
   - `getUnlabeledArticles`ツールで未ラベルブックマークを取得

4. **ラベル判定**
   - ブックマークタイトルから技術キーワードを抽出
   - 既存ラベルとマッチング
   - 適切なラベルがない場合は新規作成を検討

5. **ラベル割り当て**
   - `assignLabel`または`assignLabelsToMultipleArticles`ツールで割り当て

6. **結果レポート**
   - 処理したブックマーク数
   - 付与したラベルの内訳
   - 新規作成したラベル
   - ラベル付けできなかったブックマークとその理由

## 設定要件

### GitHub Secrets
- `CLAUDE_CODE_OAUTH_TOKEN`: Claude Code Actionの認証トークン

### 環境変数
- `API_BASE_URL`: APIエンドポイント（デフォルト: https://effective-yomimono-api.ryosuke-horie37.workers.dev）

## 注意事項

1. **ラベルの一貫性**
   - 既存ラベルを優先的に使用
   - 新規ラベル作成は最小限に

2. **処理の冪等性**
   - 既にラベルが付いているブックマークはスキップ
   - 重複実行しても問題ない設計

3. **エラーハンドリング**
   - API接続エラー時は処理を中断
   - 個別ブックマークのエラーは記録して継続

## トラブルシューティング

### MCPビルドエラー
```bash
cd mcp
pnpm install
pnpm run build
```

### API接続エラー
- `API_BASE_URL`の確認
- APIサーバーの稼働状況確認

### ラベル判定の精度向上
- Direct Promptの調整
- ラベル説明文の充実
