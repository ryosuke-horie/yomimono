# 001_フロントエンドにNextjsのRouteHandlerをBFFとして採用する

# コンテキスト

ソースコード可読性向上の一環としてフロントエンド実装を読み込んだところ、コンポーネントとAPI呼び出しが密結合で、ファイル分割や責務の整理も十分ではないと分かった。APIアクセスをクライアントに任せている現状ではセキュリティやAPIキー管理にも課題があり、将来的にCloudflare Accessで公開範囲を制限する場合はフロントエンドにキーを埋め込む必要が生じてしまう。
この状況を踏まえ、可読性と責務分離を改善しながらAPIキーをクライアントに露出させずに運用する仕組みとして、Next.js Route Handler をBFFとして導入しフロントエンドからのAPIアクセスをサーバーサイドで集約することを検討する。

# 決定
Next.jsのRoute HandlerをBFFとして採用し、すべての外部APIコールをサーバーサイドで代理実行する。
フロントエンドはRoute Handler経由の内部APIのみを利用し、リクエストパラメータの整形やレスポンスの正規化もBFF層が担うことで、UI層の責務を表示ロジックに集中させる。

# 影響
UIとAPI呼び出しの責務が分離されることでコンポーネントの見通しが良くなり、可読性とテスト容易性が向上する。
外部APIキーやアクセストークンをRoute Handlerのみで扱えるため、クライアントにシークレットを露出せずCloudflare Accessなどの将来要件にも柔軟に対応できる。
一方で、BFFレイヤーの実装と運用が新たなコストとなり、API仕様変更時にはBFFとバックエンドの両方を更新する必要が生じる。
クライアントから直接APIを呼び出す従来案を採らないため、ブラウザでの即時検証がしづらくなる点や、BFFのパフォーマンス・可用性を維持する追加の監視が求められる点にも留意する。
