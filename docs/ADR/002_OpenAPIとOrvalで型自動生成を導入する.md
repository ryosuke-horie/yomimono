# 002_OpenAPIとOrvalで型自動生成を導入する

# コンテキスト

フロントエンドとバックエンドを同一モノレポで開発しているにもかかわらず、リクエストやレスポンスの型定義は各レイヤーで重複し、変更時に同期漏れが発生しやすい。
BFF導入によってAPI契約の仲介点が増えるため、人手での型整合性維持には限界がある。
API仕様を第三者や将来のMCPサーバ実装へ共有する手段も不足している。
単一のOpenAPI定義を管理し、自動生成で各レイヤーに型とクライアントを配布できれば、可読性と保守性を両立させられる。

# 決定

HonoベースのAPIからOpenAPI仕様を出力し、その仕様をOrvalで加工してフロントエンドおよびBFF用の型・クライアントコードを自動生成する。
OpenAPIファイルは`api/openapi.yaml`を基準とし、`pnpm run openapi:gen`で更新、`pnpm run orval`で各パッケージに型を反映する運用を確立する。

# 影響

API変更時に単一のOpenAPIファイルを修正するだけでBFF・フロント・MCP向けの型が同期され、契約ズレやレビューコストが大幅に減る。
Orvalが生成する型付きクライアントにより、BFFでの変換ロジックやフロントのデータ扱いも補完され、テスト容易性が向上する。
一方で、OpenAPI定義のメンテナンスと生成コマンドの実行をCIや開発フローに組み込む必要があり、初期セットアップやビルド時間が増える。
